
CREATE DATABASE IF NOT EXISTS sudae;
USE sudae;

CREATE TABLE IF NOT EXISTS usuarios (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    matricula VARCHAR(20) NOT NULL UNIQUE,
    senha VARCHAR(32) NOT NULL,  -- MD5 sempre tem 32 caracteres
    tipo ENUM('aluno','professor','servidor_ae') NOT NULL
);

-- Trigger para garantir que toda senha inserida seja convertida em MD5
DELIMITER //

CREATE TRIGGER before_usuario_insert
BEFORE INSERT ON usuarios
FOR EACH ROW
BEGIN
    SET NEW.senha = MD5(NEW.senha);
END;
//

CREATE TRIGGER before_usuario_update
BEFORE UPDATE ON usuarios
FOR EACH ROW
BEGIN
    SET NEW.senha = MD5(NEW.senha);
END;
//

DELIMITER ;
